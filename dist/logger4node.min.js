"use strict";var r,e,t=require("node:fs"),i=require("node:path"),o=require("node:util"),n=require("path");function s(){return`[${r.removeStyles}m`}!function(r){r.cleanUp="2",r.removeStyles="0",r.highlight="1",r.grey="2",r.italic="3",r.underline="4",r.twinkle="5",r.reverse="7",r.hidden="8"}(r||(r={})),function(r){r.bBlack="40",r.bDarkRed="41",r.bGreen="42",r.bYellow="43",r.bBlue="44",r.bPurple="45",r.bDarkGreen="46",r.bWhite="47",r.fBlack="30",r.fRed="31",r.fGreen="32",r.fYellow="33",r.fBlue="34",r.fPurple="35",r.fDarkGreen="36",r.fWhite="37"}(e||(e={}));var l,g={removeStyles:s,color:function(...r){let t="";for(let i=0;i<r.length;i++){const o=r[i];Object.values(e).includes(o)?t+=`[${o}m`:t+="REMOVESTYLES"==o?s():o,i==r.length-1&&(t+=s())}return t},italic:function(e){return`[${r.italic}m${e}${s()}`},hidden:function(e){return`[${r.hidden}m${e}${s()}`},highlight:function(e){return`[${r.highlight}m${e}${s()}`},grey:function(e){return`[${r.grey}m${e}${s()}`},reverse:function(e){return`[${r.reverse}m${e}${s()}`},twinkle:function(e){return`[${r.twinkle}m${e}${s()}`},underline:function(e){return`[${r.underline}m${e}${s()}`}};function a(r,e=new Date){let t="",i="",o=-1;function n(){o+=1,i=r[o]}n();const s=e.getMilliseconds(),l=e.getSeconds(),g=e.getMinutes(),a=e.getHours(),c=e.getDate(),u=e.getMonth()+1,h=String(e.getFullYear()),f=u<10?"0"+String(u):String(u),d=c<10?"0"+String(c):String(c),m=a<10?"0"+String(a):String(a),b=g<10?"0"+String(g):String(g),S=l<10?"0"+String(l):String(l),$=s<10?"00"+String(s):s<100?"0"+String(s):String(s);for(;i;){let r=!1;"%"==`${i}`&&(r=!0,n(),"Y"==i?t+=h:"y"==i?t+=h.slice(2,3):"m"==i?t+=f:"d"==i?t+=d:"H"==i?t+=m:"M"==i?t+=b:"S"==i?t+=S:"l"==i?t+=$:r=!1),r||(t+=i),n()}return t}!function(r){r.info="info",r.error="error",r.warning="warning",r.failure="failure",r.success="success",r.debugging="debugging"}(l||(l={}));class c{log;errorLog;stream;errorStream;constructor(r,e){this.log="",this.errorLog="",r&&(this.log=i.resolve(r),this.errorLog=i.resolve(e??`${i.dirname(this.log)}/error_${i.basename(this.log)}`),this.createLog())}createLog(){const r={encoding:"utf-8",autoClose:!0,flags:"w"};if(this.log){t.mkdirSync(i.dirname(this.log),{recursive:!0});let e=!1;try{t.accessSync(this.log,t.constants.W_OK),e=!0}catch(r){String(r).includes("no such file or directory")&&(e=!0)}e?(this.stream=t.createWriteStream(i.resolve(this.log),r),this.success("Log file is created in %s",this.log)):this.error("Could not create log file")}if(this.errorLog){t.mkdirSync(i.dirname(this.errorLog),{recursive:!0});let e=!1;try{t.accessSync(this.errorLog,t.constants.W_OK),e=!0}catch(r){String(r).includes("no such file or directory")&&(e=!0)}e?(this.errorStream=t.createWriteStream(i.resolve(this.errorLog),r),this.success("Error log file is created in %s",this.errorLog)):this.error("Could not create error log file")}}basePrint(r,e){e?process.stderr.write(r+"\n"):process.stdout.write(r+"\n")}get logFile(){return this.log}set logFile(r){this.log=r,this.close(),this.createLog()}get errorLogFile(){return this.errorLog}set errorLogFile(r){this.log=r,this.close(),this.createLog()}logIsWritable(){return Boolean(this.stream?.writable)&&Boolean(this.errorStream?.writable)}writeLog(r,e){this.logIsWritable()&&(r=r.replaceAll(/\x1B\[.{0,2}[mJ]/g,""),this.stream?.write(r),this.stream?.write("\n"),e&&(this.errorStream?.write(r),this.errorStream?.write("\n")))}close(r,e){this.logIsWritable()&&(this.stream?.close(),this.errorStream?.close(),r&&t.rename(this.log,a(r),(()=>{})),e&&t.rename(this.errorLog,a(e),(()=>{})))}static buildLogRecord(r,t=l.info,...i){const n=`[${a("%Y-%m-%d %H:%M:%S.%l")}]`;switch(t){case l.error:return g.color(e.fBlack,e.bBlue,`${n}[ERROR] ${o.format(r,...i)}`);case l.failure:return g.color(e.fRed,e.bBlue,`${n}[FAILURE] ${o.format(r,...i)}`);case l.success:return g.color(e.fGreen,`${n}[SUCCESS] ${o.format(r,...i)}`);case l.warning:return g.color(e.fYellow,`${n}[WARNING] ${o.format(r,...i)}`);case l.debugging:return g.color(e.fBlue,`${n}[DEBUGGING] ${o.format(r,...i)}`);default:return`${n}[INFO] ${o.format(r,...i)}`}}print(r,e=l.info,...t){const i=c.buildLogRecord(r,e,...t);if(e==l.error)return this.basePrint(i,!0),void this.writeLog(i,!0);this.basePrint(i),this.writeLog(i)}info(r,...e){return this.print(r,l.info,...e)}error(r,...e){return this.print(r,l.error,...e)}errorHappens(r){return this.print("Error caught: %s\nCause: %s\nTraceback: %s\n%s",l.error,r.message,r.cause,r.message,r.stack)}warning(r,...e){return this.print(r,l.warning,...e)}failure(r,...e){return this.print(r,l.failure,...e)}success(r,...e){return this.print(r,l.success,...e)}debugging(r,...e){return this.print(r,l.debugging,...e)}}var u={logger:c,getLogger:function(r,e){return global.logger||(global.logger=new c(r,e),process.prependListener("beforeExit",(()=>{if(global.logger&&global.logger instanceof c){const r=n.basename(global.logger.logFile),e=n.basename(global.logger.errorLogFile),t=n.dirname(global.logger.logFile),i=n.dirname(global.logger.errorLogFile);global.logger.close(n.resolve(t,"%Y-%m-%d_%H-%M-%S_"+r),n.resolve(i,"%Y-%m-%d_%H-%M-%S_"+e))}}))),global.logger}};module.exports=u;
//# sourceMappingURL=logger4node.min.js.map
